<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mosaico Interattivo con Pan & Zoom</title>
  <style>
    /* Pagina fullscreen, sfondo scuro, niente scroll di browser */
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #111;
    }

    /* Contenitore che ospita e “inquadra” il mosaico */
    #container {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
      background-color: #111;
    }

    /*
      #mosaic è l'elemento su cui agisce panzoom.
      Layout "tipo masonry" con columns:
      - column-count: quante colonne (adatta a gusto).
      - column-gap: spazio orizzontale tra le colonne.
    */
    #mosaic {
      column-count: 4;     /* quante colonne vuoi */
      column-gap: 0;       /* spaziatura orizzontale (px, rem, ecc.) */
      /* Per smussare eventuali problemi di bounding, 
         dai un po' di padding se vuoi: es. padding-bottom: 100px; */
    }

    /* Ogni immagine è larga il 100% della colonna,
       si evita di spezzare l’immagine a fine colonna con break-inside */
    #mosaic img {
      width: 100%;
      display: block;            /* togli spazi bianchi indesiderati */
      margin-bottom: 0;          /* nessun spazio verticale aggiuntivo */
      break-inside: avoid-column;/* impedisce che un'immagine venga spezzata */
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="mosaic"></div>
  </div>

  <!-- Libreria Panzoom da JSDelivr (versione 3.2.3) -->
  <script src="https://cdn.jsdelivr.net/gh/anvaka/panzoom@3.2.3/dist/panzoom.min.js"></script>
  
  <script>
    /***************************************************************
     * 1) ELENCO DEI FILE IMMAGINE
     *    Basta fornire i nomi (o i percorsi) delle immagini
     ***************************************************************/
    const imagesList = [
      "imgs/img1.jpg",
      "imgs/img2.jpg",
      "imgs/img3.png",
      "imgs/img4.jpg",
      "imgs/img5.png",
      "imgs/img6.jpg",
      "imgs/img7.png",
      "imgs/img8.jpg",
      // Aggiungi altre immagini a piacere
    ];

    /***************************************************************
     * 2) CREAZIONE ELEMENTI <img> DENTRO #mosaic
     *    - Li creiamo in JS
     *    - Avviamo un array di Promises per attendere
     *      il caricamento effettivo di tutte le immagini
     ***************************************************************/
    const mosaic = document.getElementById("mosaic");
    const loadPromises = [];

    imagesList.forEach((imgSrc) => {
      const img = document.createElement("img");
      img.src = imgSrc;
      mosaic.appendChild(img);

      // Creiamo una Promise che si risolve quando l'immagine è caricata
      const p = new Promise((resolve, reject) => {
        img.onload = () => resolve(true);
        img.onerror = () => reject(new Error("Immagine non caricata: " + imgSrc));
      });
      loadPromises.push(p);
    });

    /***************************************************************
     * 3) DOPO CHE TUTTE LE IMMAGINI SONO CARICATE:
     *    - Otteniamo il boundingRect di #mosaic
     *    - Configuriamo Panzoom (bounds, minZoom, ecc.)
     *    - Impostiamo l'evento wheel (per zoom con rotella)
     *    - Centriamo e applichiamo lo zoom iniziale
     ***************************************************************/
    Promise.all(loadPromises)
      .then(() => {
        // Ora tutte le immagini sono cariche
        initPanzoom();
      })
      .catch((err) => {
        console.error(err);
        // Non blocchiamo la mappa, ma potremmo gestire errori
        initPanzoom();
      });

    function initPanzoom() {
      // Inizializziamo panzoom su #mosaic
      const pz = panzoom(mosaic, {
        bounds: true,        // muri invisibili
        boundsPadding: 0.2,  // un po' di margine
        minZoom: 0.5,
        maxZoom: 3
      });

      // Intercettiamo la rotella del mouse per zoom, non per scroll
      const container = document.getElementById("container");
      container.addEventListener("wheel", function (e) {
        e.preventDefault();
        pz.zoomWithWheel(e);
      }, { passive: false });

      // A questo punto #mosaic si è esteso in altezza
      // (e larghezza) in base alle immagini. Calcoliamo
      // i bounding rect per centrarci correttamente.
      centerAndZoom(pz);
    }

    function centerAndZoom(pz) {
      const containerRect = document.getElementById("container").getBoundingClientRect();
      const mosaicRect    = document.getElementById("mosaic").getBoundingClientRect();

      // Calcoliamo il centro di #mosaic
      const mosaicCenterX = mosaicRect.width  / 2;
      const mosaicCenterY = mosaicRect.height / 2;

      // Calcoliamo il centro di #container
      const containerCenterX = containerRect.width  / 2;
      const containerCenterY = containerRect.height / 2;

      // Zoom iniziale (regolalo a piacere)
      const initialZoom = 0.8;

      // ZoomAbs intorno al centro del mosaic
      pz.zoomAbs(mosaicCenterX, mosaicCenterY, initialZoom);

      // Muoviamo in modo che il centro del mosaic
      // stia al centro del container
      const finalX = containerCenterX - mosaicCenterX * initialZoom;
      const finalY = containerCenterY - mosaicCenterY * initialZoom;
      pz.moveTo(finalX, finalY);
    }
  </script>
</body>
</html>
